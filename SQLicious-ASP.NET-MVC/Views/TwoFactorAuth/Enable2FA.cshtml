@using SQLicious_ASP.NET_MVC.Models.DTOs
@model TwoFactorAuthDTO

<h2>Aktivera 2FA!</h2>

<div>
    <p>Skanna QR-koden nedan med din autentiseringsapp.</p>
    <img id="qr-code" class="qr-container" src="@Url.Action("GenerateQrCode", "TwoFactorAuth")" />

    <form asp-action="Enable2FA" method="post">
        <div>
            <label for="code">Skriv gärna in koden från din autentiseringsapp här nedan!</label>
            <input type="text" id="code" asp-for="Code" class="form-control" required />
        </div>
        <input type="submit" class="btn btn-primary" value="Verifiera" />
    </form>

    <div>
        <p>QR-koden kommer att uppdateras var <span id="timer">90</span> sekunder.</p>
    </div>
</div>

<style>
    .qr-container {
        width: 200px;
        height: 200px;
    }
</style>

<script>
    let countdown = 90;

    // Refresh QR Code every 90 seconds
    function refreshQRCode() {
        const qrImage = document.getElementById('qr-code');
        qrImage.src = '@Url.Action("GenerateQrCode", "TwoFactorAuth")' + '?' + new Date().getTime(); // Cache-busting
        countdown = 90; // Reset timer back to 90 seconds
    }

    function updateTimer() {
        countdown--;
        const timerElement = document.getElementById('timer');
        if (timerElement) {
            timerElement.textContent = countdown;
        }

        if (countdown <= 0) {
            refreshQRCode();
        }
    }

    // Set interval to refresh the QR code every second
    setInterval(updateTimer, 1000); // Update the timer every second!

    document.querySelector('form').addEventListener('submit', function (event) {
        console.log('Form submitted');
    });
</script>